<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="plone">
<body>

    <!-- VIEW -->
    <metal:define define-macro="view">
       
        <table class="datagridwidget-table-view listing"
               tal:define="columns python:widget.getColumnDefs(field, context);
                           fielddata python:field.getAccessor(context)()">
            <thead tal:condition="python: widget.hasHeader(context, field)">
                <tr>
				    <tal:block tal:repeat="c columns"
					  ><th tal:attributes="class python:not c['visible'] and 'dgw-hidden-column' or '';" 
                        tal:content="c/label" i18n:translate="">NAME</th
					></tal:block>
                </tr>
            </thead>
            <tbody>
                <tal:row-loop tal:repeat="rows fielddata">
                    <tal:view_row metal:use-macro="here/datagridwidget_view_row/macros/view_row"/>
                </tal:row-loop>  
            </tbody>
        </table>
    </metal:define>


    <!-- EDIT -->
    <metal:define define-macro="edit">
      <metal:use use-macro="field_macro | here/widgets/field/macros/edit">
        <metal:body metal:fill-slot="widget_body">
            <span style="display:none" class="dataGridRequiredFieldMessage" i18n:translate="">This column is required</span>
            <table class="datagridwidget-table-edit"
		       	tal:attributes="id python: 'datagridwidget-table-' + field.getName()"
            	style="width: 100%"
                tal:define="columns python:widget.getColumnDefs(field, context);
                            fielddata python: value or field.getEditAccessor(context)();                           
                            eventHandler python: test(widget.isAutoInsertEnabled(), 'dataGridFieldFunctions.autoInsertRow(event)', '')
                           ">
                <thead tal:condition="python: widget.hasHeader(context, field)">
                    <tr>
						<tal:block tal:repeat="c columns"
                         ><th tal:attributes="class python:not c['visible'] and 'dgw-hidden-column discreet' or 'discreet';"  style="text-align: left" 
                            ><span i18n:translate="" tal:replace="c/label" />
							<span class="fieldRequired"
                                  tal:condition="c/required|nothing"
                                  title="Required"
                                  i18n:translate="label_required"
                                  i18n:attributes="title title_required;">
                                       (Required)
                                  </span>
						</th
						 ></tal:block>
                        <th /> 
                        <th />
                        <th />
                    </tr>
                </thead>     
                       
                <tbody tal:attributes="id python: 'datagridwidget-tbody-' + field.getName()">
                
                	<tal:comment replace="nothing">
                		<!-- Existing data rows -->
                	</tal:comment>
                
                    <tal:row-loop tal:repeat="rows fielddata" tal:define="newRow python: False">
                    	<tal:row metal:use-macro="here/datagridwidget_edit_row/macros/edit_row"/>
                    </tal:row-loop>

                	<tal:comment replace="nothing">
                		<!-- A template row for adding new rows dynamically -->
                	</tal:comment>
                    
	                <tal:empty-row tal:define="newRow python: True">
	                	<tal:template metal:use-macro="here/datagridwidget_edit_row/macros/edit_empty_row"/>	                
	                </tal:empty-row>	                	
                 </tbody>
            </table>
            <tal:add_button define="default_button python:field.show_default_add;
                                    allow_insert python:field.allow_insert;
                                    field_name python:field.getName()"
                            condition="allow_insert">
                <img class="newRowButtonPlus"
                     tal:condition="not:default_button"
                     tal:attributes='src string:${portal_url}/add_row_icon.gif;
                                     onclick python: "dataGridFieldFunctions.addRow(\"" + field_name + "\")"'
                     alt="Add row"
                     i18n:attributes="title; alt"
                     title="Add row"/>
                <a class="datagridwidget-add-button" id="datagridwidget-add-button"
    			         tal:condition="default_button"
                   tal:attributes='onclick python: "dataGridFieldFunctions.addRow(\"" + field.getName() + "\")"'
                   i18n:translate="">Add new row</a>
				<div class="visualClear"><!-- --></div>
            </tal:add_button>
			<tal:comment replace="nothing">
				<!-- Button that allowes creation of the initial row when DGF is empty -->
			</tal:comment>
                        	   
        </metal:body>
      </metal:use>
    </metal:define>

    <div metal:define-macro="search">
        <div metal:use-macro="here/widgets/string/macros/edit">
        </div>
    </div>

</body>

</html>

